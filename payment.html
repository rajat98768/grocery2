<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Payment - GroceryMarket</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  <style>
    /* Your existing styles */
  </style>
</head>
<body>
  <section class="hero" id="payment">
    <div class="hero-content" style="flex-direction: column; align-items: center;">
      <h1>Pay Securely with Razorpay</h1>
      <p>Click below to complete your payment</p>

      <button class="add-to-cart" id="razorpay-button" onclick="payNow()">üí≥ Pay with Razorpay</button>

      <div id="confirmation"></div>
      <div id="error"></div>
    </div>
  </section>

  <!-- Paytm Payment Option -->
  <!-- Your existing Paytm payment section -->

  <footer class="footer">
    <div class="container">
      <p>&copy; 2025 GroceryMarket. All Rights Reserved.</p>
      <p>Made with ‚ù§Ô∏è by itz_rajat98</p>
    </div>
  </footer>

  <script>
    function calculateTotal() {
      const cart = JSON.parse(localStorage.getItem('cart')) || [];
      const total = cart.reduce((sum, item) => {
        const price = parseInt(item.price.replace(/[^\d]/g, ""));
        return sum + price * item.quantity;
      }, 0);
      return total;
    }

    function payNow() {
      const totalAmount = calculateTotal();

      console.log("Cart Total:", totalAmount);

      if (totalAmount <= 0) {
        document.getElementById("error").textContent = "‚ùå Cannot proceed: Total amount is zero.";
        return;
      }

      const options = {
        key: "YOUR_KEY_ID", // Replace with your Razorpay Key ID
        amount: totalAmount * 100,
        currency: "INR",
        name: "GroceryMarket",
        description: `Total Amount to Pay: ‚Çπ${totalAmount}`,
        image: "https://cdn-icons-png.flaticon.com/512/3081/3081559.png",
        handler: function (response) {
          // Send payment details to server for verification
          fetch('/api/verify', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              razorpay_order_id: response.razorpay_order_id,
              razorpay_payment_id: response.razorpay_payment_id,
              razorpay_signature: response.razorpay_signature
            })
          })
          .then(res => res.json())
          .then(data => {
            if (data.success) {
              document.getElementById("confirmation").textContent =
                "‚úÖ Payment successful! Payment ID: " + response.razorpay_payment_id;
            } else {
              document.getElementById("error").textContent =
                "‚ùå Payment verification failed.";
            }
          })
          .catch(error => {
            console.error('Error verifying payment:', error);
            document.getElementById("error").textContent =
              "‚ùå An error occurred during payment verification.";
          });
        },
        prefill: {
          name: "Grocery Shopper",
          email: "customer@example.com",
          contact: "9999999999"
        },
        theme: {
          color: "#00a676"
        }
      };

      const rzp = new Razorpay(options);
      rzp.open();

      rzp.on('payment.failed', function (response) {
        document.getElementById("error").textContent =
          "‚ùå Payment failed: " + response.error.description;
      });
    }

    function updatePaytmLink() {
      const total = calculateTotal();

      const upiId = "grocerymarket@paytm";
      const payeeName = "GroceryMarket";
      const currency = "INR";

      const upiUri = `upi://pay?pa=${upiId}&pn=${encodeURIComponent(payeeName)}&am=${total}&cu=${currency}`;
      document.getElementById("paytm-amount").textContent = total;

      const paytmButtonWrapper = document.getElementById("paytm-button-wrapper");
      paytmButtonWrapper.innerHTML = '';

      const button = document.createElement('a');
      button.href = upiUri;
      button.className = 'pay-button';
      button.textContent = `üì≤ Pay ‚Çπ${total} with Paytm UPI`;

      paytmButtonWrapper.appendChild(button);
    }

    function updateRazorpayButtonLabel() {
      const total = calculateTotal();
      const razorpayButton = document.getElementById("razorpay-button");
      razorpayButton.textContent = `üí≥ Pay ‚Çπ${total} with Razorpay`;
    }

    document.addEventListener("DOMContentLoaded", () => {
      updatePaytmLink();
      updateRazorpayButtonLabel();
    });
  </script>
</body>
</html>
